<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Ruby Quiz - Ducksay (#52)</title>
	<link rel="stylesheet" type="text/css" href="quiz.css" />
	<link rel="stylesheet" type="text/css" href="print.css" media="print" />
</head><body>
	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Ducksay (#52)</span>
			<p>by Jonas Pfenniger</p>
			<p class="example"> __________________________________<br />&lt; Welcome to this week's Ruby Quiz &gt;<br /> ----------------------------------<br />        \   ^__^<br />         \  (oo)\_______<br />            (__)\       )\/\<br />                ||----w |<br />                ||     ||</p>
			<p>This week, we will make some ascii-art for fun.</p>
			<p>Produce a script that generates funny talking animals. The executable
consists of three parts.</p>
			<p class="example">Part One : The balloon<br />=====================</p>
			<p>The balloon is the surrounding part, in which the text will be shown.  You can make it like you want.</p>
			<p>Examples :</p>
			<p class="example">One-liner<br /> _______________<br />&lt; I love ruby ! &gt;<br /> ---------------<br /> <br />Multiple lines with text wrapping and carriage return<br /> __________________________________________<br />/ Q:How do you stop an elephant from       \<br />| charging?                                |<br />\ A:Take away his credit cards.            /<br /> ------------------------------------------</p>
			<p class="example">Part Two : The template<br />=======================</p>
			<p>To make it flexible, we'll need a template language that can combine the animal and the text.  You'll have to think about how you want to make it flexible enough.</p>
			<p>Example :</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># thoughts is the balloon's tail</span><br />    <span class="keyword">def</span> animal(thoughts = <span class="string">'\', eyes = '</span>oo<span class="string">', tongue='</span>  ')<br />      <span class="string">%[#{baloon}<br />              #{thoughts}   ^__^<br />             #{thoughts}  (#{eyes})\\_______<br />                (__)\\       )\\/\\<br />                 #{tongue} ||----w |<br />                    ||     ||<br />    ]</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p class="example">Part Three : The command-line arguments<br />=======================================</p>
			<p>There are no special arguments. I would suggest asking for a text input, but you can also get the text from `fortune` or make it editable in place.  Optional arguments can be given to change the selected template and some of its
variables like the eyes, the tongue, and the balloon's tail.</p>
			<p>Use your imagination !</p>
			<p>So that's it for the quiz. Extra points are given to the person who
provides a duck template.</p>
			<p class="example">Credits<br />=======<br /><br />- cowsay : http://www.cowsay.net/</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p class="example"> __________________ <br />&lt; class Cow &lt; Duck &gt;<br /> ------------------ <br />    \                                _____<br />     \                         \\_-~~     ~~-_<br />      \                        /~             ~\<br />       \                     _|  _              |<br />        \                ___) ~~) ~~~--_         |<br />         \            _-~   ~-_   ___   \        |/<br />          \          /         _-~   ~-_          /<br />           \        |         /         \         |<br />            \      |  O)     |           |        |<br />                   |        |             |      |<br />                    |       |        (O   |      |<br />                     \       |           |      |\<br />                     (~-_   _-\         / _--_ / \<br />                      \__~~~   ~-_   _-~ /    ~\<br />                      /  ~---~~-_ ~~~ _-~  /|   |<br />                   _-~      / \  ~~--~    | |   |<br />                _-~                      | /   |<br />   ,-~~-_ __--~~                        |-~   /<br />   |     \                             |   _-~<br />    \                                 |--~~<br />     \                               |  |<br />      ~-_            _              |   |<br />         ~-_          ~~---__   _--~~\  |<br />            ~~--__                   /  |<br />                  ~~---___     __--~~|  |<br />                          ~~~~~      |  |<br />                                     |  |</p>
			<p>That's using Ryan Leavengood's solution to display the much celebrated line from Dave Burt's solution.  It's just so Ruby!</p>
			<p>It looks like people had plenty of fun solving this quiz, which is great.  We're all about The Fun Factor(tm) here at Ruby Quiz.</p>
			<p>Let's get to a solution:</p>
			<p class="example"> ______________________ <br />&lt; Dave Burt's Solution &gt;<br /> ---------------------- <br />   \<br />    \  .-"""-.   _.---..-;<br />      :.)     ;""      \/<br />__..--'\      ;-"""-.   ;._<br />`-.___.^.___.'-.____J__/-._J</p>
			<p>Dave is always teaching me great Ruby tricks in his solutions and this week's trick of choice is right at the top of the program:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> String<br />      <span class="keyword">def</span> width<br />        inject(0) {|w, line| [w, line.chomp.size].max }<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> height<br />        to_a.size<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> top<br />        to_a.first<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> middle<br />        to_a.values_at(1..-1)<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> bottom<br />        to_a.last<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>I just know I would have written width() as:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    map { |line| line.chomp.size }.max<br /><br /></div></div>
			<p>Dave's is more efficient though.  It only ever keeps the highest number, instead of building an Array of all the lengths.  Just one more reason inject() is the one iterator to rule them all.  Thanks for trick #562, Dave!</p>
			<p>Obviously we're just dealing with some helpers added to String above, to make later work easier.  Just remember that String.each() traverses lines by default and inject() and to_a() are defined in terms of each() and there shouldn't be any surprises here.</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">class</span> Duck<br />      <span class="keyword">def</span> <span class="keyword">self</span>.say(speech=<span class="string">"quack?"</span>, *args)<br />        balloon(speech) + body(*args)<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> <span class="keyword">self</span>.balloon(speech)<br />        <span class="string">" _#{ '_' * speech.width }_\n"</span> +<br />          <span class="keyword">if</span> speech.chomp =~ <span class="string">/\n/</span><br />            <span class="string">"/ %-#{ speech.width }s \\\n"</span> % speech.top.chomp +<br />            speech.middle.map <span class="keyword">do</span> |line|<br />              <span class="string">"| %-#{ speech.width }s |\n"</span> % line.chomp<br />            <span class="keyword">end</span>.join +<br />            <span class="string">"\\ %-#{ speech.width }s /\n"</span> % speech.bottom.chomp<br />          <span class="keyword">else</span><br />            <span class="string">"&lt; #{ speech.chomp } &gt;\n"</span><br />          <span class="keyword">end</span> +<br />        <span class="string">" -#{ '-' * speech.width }-\n"</span><br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> <span class="keyword">self</span>.body(thoughts=<span class="string">'\\', eyes='</span>cc<span class="string">', tongue='</span>  <span class="string">')<br />    "       #{thoughts}<br />            #{thoughts}<br />            _   ___<br />           / \\ /   \\<br />           \\. |: #{eyes}|<br />            (.|:,---,<br />            (.|: \\( |<br />            (.    y-'</span><br />             \\ _ / <span class="comment">#{tongue}</span><br />              m m<br />    "<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>The say() method should be easy enough to digest.  Build a balloon() and a body(), slap them together, and return them.  Beyond that, body() is almost right out of the quiz.  It just builds a String, interpolating the substitutions.</p>
			<p>That leaves balloon().  It's really just building a String too, with a little more logic thrown in.  The if branch handles multiline comments, so the speech bubble can be rounded at the edges.  Otherwise the else branch is used.  The rest is just border drawing.</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">class</span> Cow &lt; Duck<br />      <span class="keyword">def</span> <span class="keyword">self</span>.body(thoughts=<span class="string">'\\', eyes='</span>oo<span class="string">', tongue='</span>  <span class="string">')<br />    "  #{thoughts}   ^__^<br />       #{thoughts}  (#{eyes})\\_______<br />          (__)\\       )\\/\\<br />           #{tongue} ||----w |<br />              ||     ||<br />    "<br />      end<br />    end<br /><br />    class DuckOnWater &lt; Duck<br />      def self.body(thoughts='</span>\\<span class="string">', eyes='</span>º<span class="string">', tongue='</span>&gt;<span class="string">')<br />    "    #{thoughts}<br />         ` #{tongue[0, 1]}(#{eyes[0, 1]})____,<br />            (` =~~/<br />    ~^~^~^~^~`---'</span>^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~^~<br />    "<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>From there, other animals can just inherit and define a new body() method.  Now we all truly understand Duck Typing!  Everything is really just a Duck...</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">if</span> <span class="global">$0</span> == <span class="keyword">__FILE__</span><br />      <span class="keyword">if</span> ARGV.include?(<span class="string">"--help"</span>)<br />        puts <span class="string">"usage: #$0 animal thoughts eyes tongue &lt;speech\n"</span><br />        puts <span class="string">"animals: Duck Cow DuckOnWater\n"</span><br />        puts <span class="string">"e.g.: #$0 DuckOnWater o x ) &lt;/etc/fortune\n"</span><br />      <span class="keyword">else</span><br />        animal = Object.const_get(ARGV.shift) <span class="keyword">rescue</span> Duck<br />        puts animal.say(STDIN.read, *ARGV)<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The main code is trivial.  Show usage (if branch), or locate the proper class with const_get() and call say() (else branch).  That's all it really takes to get the animals talking.</p>
			<p class="example"> _________________________________________________________________ <br />&lt; Ryan Leavengood's Solution: Where even Chunky Bacon can talk... &gt;<br /> ----------------------------------------------------------------- <br />      \<br />       \  __      _.._<br />       .-'__`-._.'.--.'.__.,<br />      /--'  '-._.'    '-._./<br />     /__.--._.--._.'``-.__/<br />     '._.-'-._.-._.-''-..'</p>
			<p>I won't show the whole thing here, but do look it over.  It had a nice collection of animals embedded in the DATA section of the code.  They were controlled through a Zoo class, where even a random animal could be chosen to escape():</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="comment"># Our lovely Zoo, full of many wacky animals</span><br />    <span class="keyword">class</span> Zoo<br />      include Singleton<br />      attr_reader :animals<br />      <span class="keyword">def</span> initialize<br />        <span class="variable">@animals</span> = {}<br />        current_key = <span class="keyword">nil</span><br />        DATA.each <span class="keyword">do</span> |line|<br />          <span class="keyword">if</span> line.chomp =~ <span class="string">/^'(\w*)':$/</span><br />            current_key = <span class="global">$1</span><br />            <span class="variable">@animals</span>[current_key] = []<br />          <span class="keyword">elsif</span> current_key<br />            <span class="variable">@animals</span>[current_key] &lt;&lt; line<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># A random animal has escaped!</span><br />      <span class="keyword">def</span> escape<br />        choices = <span class="variable">@animals</span>.keys<br />        <span class="variable">@animals</span>[choices[rand(choices.length)]]<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Ryan also emulated fortune for Windows, with only a few lines of code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    require <span class="string">'open-uri'</span><br /><br />    <span class="comment"># ...</span><br /><br />    <span class="comment"># Since I wrote this on Windows I don't have fortune...but the</span><br />    <span class="comment"># internet does!</span><br />    <span class="keyword">def</span> get_fortune<br />      open(<span class="string">'http://www.coe.neu.edu/cgi-bin/fortune'</span>) <span class="keyword">do</span> |page|<br />        page.read.scan(<span class="string">/&lt;pre&gt;(.*)&lt;\/pre&gt;/</span>m)[0][0].gsub(<span class="string">"\t"</span>,<span class="string">'   '</span>)<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Fun to read and educational at the same time.  You can't beat that folks!</p>
			<p class="example"> ________________<br />&lt; The Other Guys &gt;<br /> ----------------<br />       \<br />        \<br />        _   ___<br />       / \ /   \<br />       \. |: ^-|<br />        (.|:,---,<br />        (.|: \( |<br />        (.    y-'<br />         \ _ /   <br />          m m</p>
			<p>Jacob Quinn Shenker golfed the solution, needing less than 400 strokes.  Check it out.</p>
			<p>JB Eriksson supported thought bubbles and sent in a duck on water template.  More good stuff.</p>
			<p class="example"> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />(Wrap Up:  This went just swimmingly!)<br /> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 <br />      o<br />       ` &gt;(o)____,<br />          (` =~~/<br />  ^~^~^~^~^~`---'^~^~^~^~^~</p>
			<p>I have to offer major thanks to everyone who made is possible for me to fill a quiz summary with animal drawings!  How cool is that?</p>
			<p>Tomorrow's quiz takes us from animals to appliances as we build our own DRYer...</p>
		</div>
		<div id="logo"><img src="images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/162130">Dave Burt</a></li>
				<li><a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/162138">JB Eriksson</a></li>
				<li><a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/162172">Jacob Quinn Shenker</a></li>
				<li><a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/162211">Ryan Leavengood</a></li>
			</ol>
			<p><a href="quiz52_sols.zip">Download Solutions</a></p>
			<p><a href="index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>
